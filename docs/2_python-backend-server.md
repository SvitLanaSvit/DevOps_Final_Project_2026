# Python backend server (server.py)

## Призначення

Цей скрипт реалізує мінімальний HTTP backend для фінального проєкту. Він потрібен, щоб:
- слухати вхідні HTTP‑запити на певному порту;
- повертати статус `200 OK` на запит до кореневого шляху `/`;
- віддавати в відповіді IP‑адресу pod'а (або хоста), на якому запущений контейнер;
- коректно працювати всередині Kubernetes‑подів, коли IP може передаватися через змінну середовища.

Надалі цей скрипт буде запаковано в Docker‑образ, задеплоєно в Kubernetes (EKS) і керуватись через ArgoCD.

## Локація файлу

Скрипт знаходиться в папці `py_project`:
- `py_project/server.py`

## Як працює server.py

- Використовує стандартну бібліотеку Python:
  - `http.server` — для реалізації простого HTTP‑сервера;
  - `socket` — для отримання IP‑адреси хоста;
  - `os` — для читання змінних середовища.
- Слухає всі інтерфейси (`0.0.0.0`). Порт задається так:
  - якщо встановлена змінна середовища `PORT` — використовується вона;
  - інакше використовується порт `8000` за замовчуванням.
- Функція `detect_ip()` визначає IP так:
  - якщо є змінна середовища `POD_IP` (наприклад, задана через Downward API у Kubernetes) — повертає її;
  - інакше пробує `socket.gethostbyname(socket.gethostname())`;
  - у випадку помилки повертає рядок `"unknown"`.
- Обробляє тільки запити `GET`:
  - Якщо шлях `"/"`:
    - Викликає `detect_ip()` і отримує IP.
    - Формує текстове повідомлення `"OK from pod IP: <ip>\n"`.
    - Відправляє відповідь зі статусом `200`, заголовком `Content-Type: text/plain; charset=utf-8` і коректною довжиною в байтах.
  - Для всіх інших шляхів повертає `404`.

Сервер запускається при виконанні файлу напряму (блок `if __name__ == "__main__":`).

## Як запустити локально

1. Перейти в директорію з проєктом та підпапку `py_project`:
   ```bash
   cd /d/DevOps/Final_Project_2026/py_project
   ```
2. Запустити сервер:
   ```bash
   python server.py
   ```
3. Перевірити роботу:
   - у браузері: `http://localhost:8000/`
   - або через curl:
     ```bash
     curl http://localhost:8000/
     ```

У відповідь має прийти рядок виду:

```text
OK from pod IP: 192.168.x.x
```

Саме цю поведінку вимагали в умові завдання (проста відповідь 200 на `/` з IP‑адресою пода).
